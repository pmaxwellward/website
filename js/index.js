var manGIFs = [];
var angerGIFs = [];
var blurbGIFs = [];
var firstGIFs = [];
var introGIFs = [];
var maxW = window.matchMedia("(max-width:499px)");
var minW = window.matchMedia("(min-width:500px)");

if(maxW.matches) {
    pushMan(
        "mGIFs/00.gif",
        "mGIFs/01.gif",
        "mGIFs/02.gif",
        "mGIFs/03.gif",
        "mGIFs/04.gif",
        "mGIFs/05.gif",
        "mGIFs/06.gif",
        "mGIFs/07.gif",
        "mGIFs/08.gif",
        "mGIFs/09.gif",
        "mGIFs/10.gif",
        "mGIFs/11.gif",
        "mGIFs/12.gif",
        "mGIFs/13.gif",
        "mGIFs/14.gif",
        "mGIFs/15.gif",
        "mGIFs/16.gif",
        "mGIFs/17.gif",
        "mGIFs/18.gif",
        "mGIFs/19.gif",
        "mGIFs/20.gif",
        "mGIFs/21.gif"
    )
    pushAnger(
        "mGIFs/anger_00.gif",
        "mGIFs/anger_01.gif",
        "mGIFs/anger_02.gif",
        "mGIFs/anger_03.gif",
        "mGIFs/anger_04.gif",
        "mGIFs/anger_05.gif",
        "mGIFs/anger_06.gif",
        "mGIFs/anger_07.gif",
        "mGIFs/anger_08.gif",
        "mGIFs/anger_09a.gif",
        "mGIFs/anger_09b.gif",
        "mGIFs/anger_10.gif",
        "mGIFs/anger_11.gif",
        "mGIFs/anger_12.gif",
        "mGIFs/anger_13.gif",
        "mGIFs/anger_14.gif",
        "mGIFs/anger_15.gif"
    )
    pushBlurb(
        "mGIFs/blurb_00a.gif",
        "mGIFs/blurb_00b.gif",
        "mGIFs/blurb_01a.gif",
        "mGIFs/blurb_01b.gif",
        "mGIFs/blurb_02a.gif",
        "mGIFs/blurb_02b.gif",
        "mGIFs/blurb_03a.gif",
        "mGIFs/blurb_03b.gif",
        "mGIFs/blurb_04.gif",
        "mGIFs/blurb_05a.gif",
        "mGIFs/blurb_05b.gif",
        "mGIFs/blurb_05c.gif",
        "mGIFs/blurb_06a.gif",
        "mGIFs/blurb_06b.gif",
        "mGIFs/blurb_07.gif",
        "mGIFs/blurb_08a.gif",
        "mGIFs/blurb_08b.gif",
        "mGIFs/blurb_09.gif",
        "mGIFs/blurb_10a.gif",
        "mGIFs/blurb_10b.gif",
        "mGIFs/blurb_11.gif",
        "mGIFs/blurb_12a.gif",
        "mGIFs/blurb_12b.gif",
        "mGIFs/blurb_13a.gif",
        "mGIFs/blurb_13b.gif",
        "mGIFs/blurb_14a.gif",
        "mGIFs/blurb_14b.gif",
        "mGIFs/blurb_15.gif",
        "mGIFs/blurb_16a.gif",
        "mGIFs/blurb_16b.gif",
        "mGIFs/blurb_17a.gif",
        "mGIFs/blurb_17b.gif",
        "mGIFs/blurb_17c.gif"
    )
    pushFirst(
        "mGIFs/first_00.gif",
        "mGIFs/first_01.gif",
        "mGIFs/first_02.gif",
        "mGIFs/first_03.gif"
    )
    pushIntro(
        "mGIFs/intro_00a.gif",
        "mGIFs/intro_00b.gif",
        "mGIFs/intro_01a.gif",
        "mGIFs/intro_01b.gif",
        "mGIFs/intro_02.gif",
        "mGIFs/intro_03a.gif",
        "mGIFs/intro_03b.gif",
        "mGIFs/intro_04a.gif",
        "mGIFs/intro_04b.gif"  
    )
}
if(minW.matches) {
    pushMan(
        "GIFs/00.gif",
        "GIFs/01.gif",
        "GIFs/02.gif",
        "GIFs/03.gif",
        "GIFs/04.gif",
        "GIFs/05.gif",
        "GIFs/06.gif",
        "GIFs/07.gif",
        "GIFs/08.gif",
        "GIFs/09.gif",
        "GIFs/10.gif",
        "GIFs/11.gif",
        "GIFs/12.gif",
        "GIFs/13.gif",
        "GIFs/14.gif",
        "GIFs/15.gif",
        "GIFs/16.gif",
        "GIFs/17.gif",
        "GIFs/18.gif",
        "GIFs/19.gif",
        "GIFs/20.gif",
        "GIFs/21.gif"
    )
    pushAnger(
        "GIFs/anger_00.gif",
        "GIFs/anger_01.gif",
        "GIFs/anger_02.gif",
        "GIFs/anger_03.gif",
        "GIFs/anger_04.gif",
        "GIFs/anger_05.gif",
        "GIFs/anger_06.gif",
        "GIFs/anger_07.gif",
        "GIFs/anger_08.gif",
        "GIFs/anger_09a.gif",
        "GIFs/anger_09b.gif",
        "GIFs/anger_10.gif",
        "GIFs/anger_11.gif",
        "GIFs/anger_12.gif",
        "GIFs/anger_13.gif",
        "GIFs/anger_14.gif",
        "GIFs/anger_15.gif"
    )
    pushBlurb(
        "GIFs/blurb_00a.gif",
        "GIFs/blurb_00b.gif",
        "GIFs/blurb_01a.gif",
        "GIFs/blurb_01b.gif",
        "GIFs/blurb_02a.gif",
        "GIFs/blurb_02b.gif",
        "GIFs/blurb_03a.gif",
        "GIFs/blurb_03b.gif",
        "GIFs/blurb_04.gif",
        "GIFs/blurb_05a.gif",
        "GIFs/blurb_05b.gif",
        "GIFs/blurb_05c.gif",
        "GIFs/blurb_06a.gif",
        "GIFs/blurb_06b.gif",
        "GIFs/blurb_07.gif",
        "GIFs/blurb_08a.gif",
        "GIFs/blurb_08b.gif",
        "GIFs/blurb_09.gif",
        "GIFs/blurb_10a.gif",
        "GIFs/blurb_10b.gif",
        "GIFs/blurb_11.gif",
        "GIFs/blurb_12a.gif",
        "GIFs/blurb_12b.gif",
        "GIFs/blurb_13a.gif",
        "GIFs/blurb_13b.gif",
        "GIFs/blurb_14a.gif",
        "GIFs/blurb_14b.gif",
        "GIFs/blurb_15.gif",
        "GIFs/blurb_16a.gif",
        "GIFs/blurb_16b.gif",
        "GIFs/blurb_17a.gif",
        "GIFs/blurb_17b.gif",
        "GIFs/blurb_17c.gif"
    )
    pushFirst(
        "GIFs/first_00.gif",
        "GIFs/first_01.gif",
        "GIFs/first_02.gif",
        "GIFs/first_03.gif"
    )
    pushIntro(
        "GIFs/intro_00a.gif",
        "GIFs/intro_00b.gif",
        "GIFs/intro_01a.gif",
        "GIFs/intro_01b.gif",
        "GIFs/intro_02.gif",
        "GIFs/intro_03a.gif",
        "GIFs/intro_03b.gif",
        "GIFs/intro_04a.gif",
        "GIFs/intro_04b.gif"  
    )
}

const man_00 = {name: manGIFs[0].src, length: 625};         //idle 
const man_01 = {name: manGIFs[1].src, length: 1375};        //idle_in
const man_02 = {name: manGIFs[2].src, length: 875};         //idle_headIn        
const man_03 = {name: manGIFs[3].src, length: 1750};        //idle_head
const man_04 = {name: manGIFs[4].src, length: 458.333};     //idle_headOut
const man_05 = {name: manGIFs[5].src, length: 250};         //headScratch_in
const man_06 = {name: manGIFs[6].src, length: 416.666};     //headScratch
const man_07 = {name: manGIFs[7].src, length: 250};         //headScratch_out
const man_08 = {name: manGIFs[8].src, length: 500};         //fly
const man_09 = {name: manGIFs[9].src, length: 625};         //fly_in
const fly_10 = {name: manGIFs[10].src, length: 1333.333};   //fly_1
const fly_11 = {name: manGIFs[11].src, length: 1166.666};   //fly_2
const fly_12 = {name: manGIFs[12].src, length: 1125};       //fly_3
const fly_13 = {name: manGIFs[13].src, length: 1333.333};   //fly_4
const fly_14 = {name: manGIFs[14].src, length: 1166.666};   //fly_5
const fly_15 = {name: manGIFs[15].src, length: 1125};       //fly_6
const man_16 = {name: manGIFs[16].src, length: 1666.666};   //fly_out
const man_17 = {name: manGIFs[17].src, length: 1166.666};   //lipSync_in
const man_18 = {name: manGIFs[18].src, length: 166.666};    //lipSync_out
const man_19 = {name: manGIFs[19].src, length: 833.333};    //lipSyncIdle_in
const man_20 = {name: manGIFs[20].src, length: 1875};       //lipSynceIdle
const man_21 = {name: manGIFs[21].src, length: 333.333};    //lipSyncIdle_out

const anger_00 = angerGIFs[0].src;
const anger_01 = angerGIFs[1].src;
const anger_02 = angerGIFs[2].src;
const anger_03 = angerGIFs[3].src;
const anger_04 = angerGIFs[4].src;
const anger_05 = angerGIFs[5].src;
const anger_06 = angerGIFs[6].src;
const anger_07 = angerGIFs[7].src;
const anger_08 = angerGIFs[8].src;
const anger_09 = [angerGIFs[9].src, angerGIFs[10].src];
const anger_10 = angerGIFs[11].src;
const anger_11 = angerGIFs[12].src;
const anger_12 = angerGIFs[13].src;
const anger_13 = angerGIFs[14].src;
const anger_14 = angerGIFs[15].src;
const anger_15 = angerGIFs[16].src;

const blurb_00 = [blurbGIFs[0].src,blurbGIFs[1].src];
const blurb_01 = [blurbGIFs[2].src,blurbGIFs[3].src]
const blurb_02 = [blurbGIFs[4].src,blurbGIFs[5].src]; 
const blurb_03 = [blurbGIFs[6].src,blurbGIFs[7].src];
const blurb_04 = blurbGIFs[8].src;
const blurb_05 = [blurbGIFs[9].src,blurbGIFs[10].src,blurbGIFs[11].src];
const blurb_06 = [blurbGIFs[12].src,blurbGIFs[13].src];
const blurb_07 = blurbGIFs[14].src;
const blurb_08 = [blurbGIFs[15].src,blurbGIFs[16].src];
const blurb_09 = blurbGIFs[17].src;
const blurb_10 = [blurbGIFs[18].src,blurbGIFs[19].src];
const blurb_11 = blurbGIFs[20].src;
const blurb_12 = [blurbGIFs[21].src,blurbGIFs[22].src];
const blurb_13 = [blurbGIFs[23].src,blurbGIFs[24].src];
const blurb_14 = [blurbGIFs[25].src,blurbGIFs[26].src];
const blurb_15 = blurbGIFs[27].src;
const blurb_16 = [blurbGIFs[28].src,blurbGIFs[29].src];
const blurb_17 = [blurbGIFs[30].src,blurbGIFs[31].src,blurbGIFs[32].src];

const first_00 = firstGIFs[0].src;
const first_01 = firstGIFs[1].src;
const first_02 = firstGIFs[2].src;
const first_03 = firstGIFs[3].src;

const intro_00 = [introGIFs[0].src,introGIFs[1].src];
const intro_01 = [introGIFs[2].src,introGIFs[3].src];
const intro_02 = introGIFs[4].src;
const intro_03 = [introGIFs[5].src,introGIFs[6].src];
const intro_04 = [introGIFs[7].src,introGIFs[8].src];

const gifMan = document.querySelector(".gif-Man img");
const textBox = document.querySelector(".text-Box img");

gifMan.src = man_00.name;

var idleLoop;
var idleCycle;
var idleState;
var loading;
var loadingText;
var flyIndex = 0;
var angerIndex = 0;
var blurbIndex = 0;
var subIndex = 0;
var textLength = 3500;
var buttonOn = false;
var firstPress = false;
var isSpeaking = false;
var range = [3,4,5];

var fly = [
    fly_10,
    fly_11,
    fly_12,
    fly_13,
    fly_14,
    fly_15];

var anger = [
    anger_00,
    anger_01,
    anger_02,
    anger_03,
    anger_04,
    anger_05,
    anger_06,
    anger_07,
    anger_08,
    anger_09,
    anger_10,
    anger_11,
    anger_12,
    anger_13,
    anger_14,
    anger_15];

var blurb = [   
    blurb_00,
    blurb_01,
    blurb_02,
    blurb_03,
    blurb_04,
    blurb_05,
    blurb_06,
    blurb_07,
    blurb_08,
    blurb_09,
    blurb_10,
    blurb_11,
    blurb_12,
    blurb_13,
    blurb_14,
    blurb_15,
    blurb_16,
    blurb_17];

var first = [   
    first_00,
    first_01,
    first_02,
    first_03];

var intro = [
    intro_00,
    intro_01,
    intro_02,
    intro_03,
    intro_04];

shuffle(anger);
shuffle(blurb);
shuffle(first);
shuffle(intro);

document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function(){
        textBox.src = first[0];
        setTimeout(playScene, man_00.length);
       }, 1000);
 }, false);

function pushMan() {
    for (var i = 0; i < arguments.length; i++) {
        manGIFs[i] = new Image();
        manGIFs[i].src = pushMan.arguments[i];
    }
}
function pushAnger() {
    for (var i = 0; i < arguments.length; i++) {
        angerGIFs[i] = new Image();
        angerGIFs[i].src = pushAnger.arguments[i];
    }
}
function pushBlurb() {
    for (var i = 0; i < arguments.length; i++) {
        blurbGIFs[i] = new Image();
        blurbGIFs[i].src = pushBlurb.arguments[i];
    }
}
function pushFirst() {
    for (var i = 0; i < arguments.length; i++) {
        firstGIFs[i] = new Image();
        firstGIFs[i].src = pushFirst.arguments[i];
    }
}
function pushIntro() {
    for (var i = 0; i < arguments.length; i++) {
        introGIFs[i] = new Image();
        introGIFs[i].src = pushIntro.arguments[i];
    }
}
function playScene() {
    switch(gifMan.src) {
        
        case man_00.name:
            if(firstPress == false) {
                loadScene(man_19);
            }
            if(firstPress == true) {
                loadScene(man_01);
            }
            break;

        case man_01.name:
            idleCycle = range[Math.floor(Math.random() * 3)];
            idleState = Math.floor(Math.random() * 5);
                
            if(idleState == 1) {
                loadScene(man_02);
                idleLoop = 1;
            } else if (idleState == 2) {
                loadScene(man_05);
                idleLoop = 1;
            } else if (idleState == 3 || idleState == 4) {
                loadScene(man_19);
            } else {
                loadScene(man_00);
            }
            break;

        case man_02.name:
            loadScene(man_03);
            break;

        case man_03.name:
            if(idleLoop != idleCycle) {
                loadScene(man_03);
                idleLoop++;
            } else {
                loadScene(man_04);
            }
            break;

        case man_04.name:
            idleCycle = range[Math.floor(Math.random() * 3)];
            idleState = Math.floor(Math.random() * 4);
            
            if(idleState == 1) {
                loadScene(man_05);
                idleLoop = 1;
            } else if (idleState == 2 || idleState == 3) {
                loadScene(man_19);
            } else {
                loadScene(man_00);
            }
            break;

        case man_05.name:
            loadScene(man_06);
            break;

        case man_06.name:
            if(idleLoop != idleCycle) {
                loadScene(man_06);
                idleLoop++;
            } else {
                loadScene(man_07);
            }
            break;

        case man_07.name:
            idleCycle = range[Math.floor(Math.random() * 3)];
            idleState = Math.floor(Math.random() * 2);

            if(idleState == 1) {
            	loadScene(man_02);
            	idleLoop = 1;
            } else {
            	loadScene(man_00);
            }
            break;

        case man_08.name:
            loadScene(man_09);
            break;

        case man_09.name:
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_10.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_11.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_12.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_13.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_14.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case fly_15.name:
            flyIndex++;
            if(flyIndex < 3) {
                loadScene(fly[flyIndex]);
            } 
            else {
                loadScene(man_16);
            }
            break;

        case man_16.name:
            flyIndex = 0;
            buttonOn = false;
            loadScene(man_17);
            loadText(anger[angerIndex]);
            isSpeaking = true;
            break;

        case man_17.name:
            if(isSpeaking == false) {
                loadScene(man_18);
            }
            break;

        case man_18.name:
            loadScene(man_01);
            break;

        case man_19.name:
            loadScene(man_20);
            if(firstPress == false) {
                loadText(first[0]);
                firstPress = true;
            } else {
                loadText(blurb[blurbIndex]);
            }
            isSpeaking = true;
            break;

        case man_20.name:
            if(isSpeaking == false) {
                loadScene(man_21);
            }
            break;

        case man_21.name:
            loadScene(man_00);
            break;

        default:
            console.log("error");
    }
}

function loadScene(scene) {       
    gifMan.src = scene.name;
    loading = setTimeout(playScene, scene.length);
}

function poke() {
    if (buttonOn == false) {
        clearTimeout(loading);
        clearTimeout(loadingText);
        textBox.style.visibility = "hidden";
        buttonOn = true;
        shuffle(fly);
        loadScene(man_08);   
    } else {
        null;
    }
}
function shuffle(a) {
	var j, x, i;
	for (i = a.length - 1; i > 0; i--) {
		j = Math.floor(Math.random() * (i + 1));
		x = a[i];
		a[i] = a[j];
		a[j] = x;
	}
	return a;
}
function loadText(scene) {
    if(Array.isArray(scene)) {
        textBox.src = scene[subIndex];
        loadingText = setTimeout(playText,textLength);
        textBox.style.visibility = "visible";
    } else {
        textBox.src = scene;
        loadingText = setTimeout(playText,textLength);
        textBox.style.visibility = "visible";
    }
}

function playText(scene) {
    switch(textBox.src) {
           
        case first[0]:
            loadText(intro[0]);
            break;

        case intro[0]:
            isSpeaking = false;
            textBox.style.visibility = "hidden";
            playScene();
            break;

        case intro[0][subIndex]:
            if(subIndex < intro[0].length-1) {
                subIndex++;
                loadText(intro[0][subIndex]);
            } else {
                subIndex = 0;
                isSpeaking = false;
                textBox.style.visibility = "hidden";
                playScene();
            }
            break;
            
        case blurb[blurbIndex]:
            if(blurbIndex != blurb.length-1) {
                blurbIndex++;
            } else {
                blurbIndex = 0;
                shuffle(blurb);
            }
            isSpeaking = false;
            textBox.style.visibility = "hidden";
            playScene();
            break;

        case blurb[blurbIndex][subIndex]:
            if(subIndex < blurb[blurbIndex].length-1) {
                subIndex++;
                loadText(blurb[blurbIndex][subIndex]);
            } else {
                if(blurbIndex != blurb.length-1) {
                    blurbIndex++;
                } else {
                    blurbIndex = 0;
                    shuffle(blurb);
                }
                subIndex = 0;
                isSpeaking = false;
                textBox.style.visibility = "hidden";
                playScene();
            }
            break;

        case anger[angerIndex]:
        if(angerIndex != anger.length-1) {
            angerIndex++;
        } else {
            angerIndex = 0;
            shuffle(anger);
        }
        isSpeaking = false;
        textBox.style.visibility = "hidden";
        playScene();
        break;

        case anger[angerIndex][subIndex]:
            if(subIndex < anger[angerIndex].length-1) {
                subIndex++;
                loadText(anger[angerIndex][subIndex]);
            } else {
                if(angerIndex != anger.length-1) {
                    angerIndex++;
                } else {
                    angerIndex = 0;
                    shuffle(anger);
                }
                subIndex = 0;
                isSpeaking = false;
                textBox.style.visibility = "hidden";
                playScene();
            }
            break;

        default:
            console.log("you're wrong");
            isSpeaking = false;
            textBox.style.visibility = "hidden";
            playScene();
    }
}

